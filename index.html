<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blue Square Game</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: black;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

#gameCanvas {
    display: block;
    margin: auto;
    background: #111;
    touch-action: none;
}

#score {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: 24px;
    z-index: 1000;
}

/* Retry screen */
#retryScreen {
    position: fixed;
    top:0;
    left:0;
    width: 100%;
    height:100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 32px;
    z-index: 2000;
    display: none;
}

#retryScreen button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 24px;
    border: none;
    border-radius: 10px;
    background: #222;
    color: white;
}

/* Bottom-centered cross buttons */
.buttons {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 140px;
    height: 140px;
    display: grid;
    grid-template-columns: 50px 50px 50px;
    grid-template-rows: 50px 50px 50px;
    gap: 0;
    z-index: 1000;
}

.buttons button {
    width: 50px;
    height: 50px;
    font-size: 24px;
    border-radius: 10px;
    border: none;
    background: rgba(255,255,255,0.2);
    color: white;
    backdrop-filter: blur(5px);
}

/* Grid positions for cross layout */
#upBtn { grid-column: 2; grid-row: 1; }
#leftBtn { grid-column: 1; grid-row: 2; }
#downBtn { grid-column: 2; grid-row: 3; }
#rightBtn { grid-column: 3; grid-row: 2; }

@media screen and (max-width: 400px) {
    .buttons {
        width: 120px;
        height: 120px;
        grid-template-columns: 40px 40px 40px;
        grid-template-rows: 40px 40px 40px;
    }
    .buttons button {
        width: 40px;
        height: 40px;
        font-size: 20px;
    }
}
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<div id="score">Score: 0</div>

<div class="buttons">
    <button id="upBtn">↑</button>
    <button id="leftBtn">←</button>
    <button id="downBtn">↓</button>
    <button id="rightBtn">→</button>
</div>

<div id="retryScreen">
    <div id="finalScore">Game Over!</div>
    <button id="retryBtn">Retry</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreDisplay = document.getElementById('score');
const retryScreen = document.getElementById('retryScreen');
const finalScore = document.getElementById('finalScore');
const retryBtn = document.getElementById('retryBtn');

let score = 0;

// Resize canvas to fill screen minus controls
function resizeGame() {
    const screenW = window.innerWidth;
    const screenH = window.innerHeight;
    canvas.width = screenW;
    canvas.height = screenH - 180; // leave space for buttons
}
resizeGame();
window.addEventListener("resize", resizeGame);

// Player
let player = { x:50, y:50, size:20, speed:1.7 };
let dx = player.speed;
let dy = 1;
const maxSpeed = 2.5;

// Enemy
let enemy = { x:300, y:300, size:20, speed:1.1 };

// Coin
let coin = { x: Math.random() * 300, y: Math.random() * 300, size:10 };

// Arrow buttons
const upBtn = document.getElementById('upBtn');
const downBtn = document.getElementById('downBtn');
const leftBtn = document.getElementById('leftBtn');
const rightBtn = document.getElementById('rightBtn');

upBtn.addEventListener("touchstart", () => { dx=0; dy=-player.speed; });
downBtn.addEventListener("touchstart", () => { dx=0; dy=player.speed; });
leftBtn.addEventListener("touchstart", () => { dx=-player.speed; dy=0; });
rightBtn.addEventListener("touchstart", () => { dx=player.speed; dy=0; });

document.addEventListener("keydown", e => {
    if(e.key==="ArrowUp"){ dx=0; dy=-player.speed; }
    if(e.key==="ArrowDown"){ dx=0; dy=player.speed; }
    if(e.key==="ArrowLeft"){ dx=-player.speed; dy=0; }
    if(e.key==="ArrowRight"){ dx=player.speed; dy=0; }
});

// Retry button
retryBtn.addEventListener("click", () => {
    score = 0;
    scoreDisplay.textContent = "Score: 0";
    player.x = 50; player.y = 50;
    player.speed = 2;
    dx = player.speed; dy = 0;
    enemy.x = 300; enemy.y = 300;
    coin.x = Math.random() * canvas.width;
    coin.y = Math.random() * canvas.height;
    retryScreen.style.display = "none";
});

function update() {
    // Gradually increase player speed up to maxSpeed
    if(player.speed < maxSpeed) player.speed += 0.002;

    player.x += dx;
    player.y += dy;

    // Keep player inside canvas
    if(player.x<0) player.x=0;
    if(player.y<0) player.y=0;
    if(player.x+player.size>canvas.width) player.x=canvas.width-player.size;
    if(player.y+player.size>canvas.height) player.y=canvas.height-player.size;

    // Enemy constant speed movement
    let angle = Math.atan2(player.y - enemy.y, player.x - enemy.x);
    enemy.x += Math.cos(angle) * enemy.speed;
    enemy.y += Math.sin(angle) * enemy.speed;

    // Collision with enemy
    if(player.x < enemy.x + enemy.size &&
       player.x + player.size > enemy.x &&
       player.y < enemy.y + enemy.size &&
       player.y + player.size > enemy.y) {
        finalScore.textContent = "Game Over! Score: " + score;
        retryScreen.style.display = "flex";
        return;
    }

    // Collision with coin
    if(player.x < coin.x + coin.size &&
       player.x + player.size > coin.x &&
       player.y < coin.y + coin.size &&
       player.y + player.size > coin.y) {
        score++;
        scoreDisplay.textContent = "Score: " + score;
        coin.x = Math.random() * (canvas.width - coin.size);
        coin.y = Math.random() * (canvas.height - coin.size);
    }
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // Player
    ctx.fillStyle = "blue";
    ctx.fillRect(player.x, player.y, player.size, player.size);
    // Enemy
    ctx.fillStyle = "red";
    ctx.fillRect(enemy.x, enemy.y, enemy.size, enemy.size);
    // Coin
    ctx.fillStyle = "yellow";
    ctx.fillRect(coin.x, coin.y, coin.size, coin.size);
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>